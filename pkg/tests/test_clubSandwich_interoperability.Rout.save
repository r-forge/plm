
R version 3.4.2 (2017-09-28) -- "Short Summer"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## Test of interoperability of vcov generated by package 'clubSandwich' with pwaldtest
> ## test of detection of those vcovs and test of translation function trans_clubSandwich_vcov
> 
> library(plm)
Loading required package: Formula
> library(clubSandwich)
> library(lmtest)
Loading required package: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric

> 
> data("MortalityRates", package = "clubSandwich")
> 
> # partly from clubSandwich's vignette
> # subset for deaths in motor vehicle accidents, 1970-1983
> MV_deaths <- subset(MortalityRates, cause=="Motor Vehicle" & 
+                       year <= 1983 & !is.na(beertaxa))
> 
> plm_unweighted <- plm(mrate ~ legal + beertaxa, data = MV_deaths, 
+                       effect = "individual", index = c("state","year"))
> 
> plm_unweighted_re <- plm(mrate ~ legal + beertaxa, data = MV_deaths, model = "random",
+                       effect = "twoways", index = c("state","year"), random.method = "walhus")
> 
> coef_test(plm_unweighted, vcov = "CR1", cluster = "individual", test = "naive-t")
      Coef Estimate   SE p-val (naive-t) Sig.
1    legal     4.42 2.13           0.043    *
2 beertaxa    30.25 5.99          <0.001  ***
> coef_test(plm_unweighted, vcov = "CR1", cluster = "individual", test = "Satterthwaite")
      Coef Estimate   SE  d.f. p-val (Satt) Sig.
1    legal     4.42 2.13 20.62       0.0504    .
2 beertaxa    30.25 5.99  8.89       <0.001  ***
> 
> 
> vcov_club_id   <- vcovCR(plm_unweighted, type = "CR0", cluster = "individual")
> vcov_club_time <- vcovCR(plm_unweighted, type = "CR0", cluster = "time")
> vcov_plm_id    <- vcovHC(plm_unweighted, method="arellano", type="HC0", cluster = "group")
> vcov_plm_time  <- vcovHC(plm_unweighted, method="arellano", type="HC0", cluster = "time")
> 
> if (!isTRUE(all.equal(as.matrix(vcov_club_id),   vcov_plm_id,   check.attributes = FALSE))) stop("vcov_club_id and vcov_plm_id differ")
> if (!isTRUE(all.equal(as.matrix(vcov_club_time), vcov_plm_time, check.attributes = FALSE))) stop("vcov_club_time and vcov_plm_time differ")
> 
> 
> # some features:
> is.matrix(vcov_club_id) # TRUE
[1] TRUE
> class(vcov_club_id) # c("vcovCR", "clubSandwich")
[1] "vcovCR"       "clubSandwich"
> str(vcov_club_id)
 vcovCR [1:2, 1:2] 4.43 -0.372 -0.372 35.2
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:2] "legal" "beertaxa"
  ..$ : chr [1:2] "legal" "beertaxa"
 - attr(*, "type")= chr "CR0"
 - attr(*, "cluster")= Factor w/ 50 levels "1","2","4","5",..: 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, "bread")= num [1:2, 1:2] 1.22 0.617 0.617 5.962
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:2] "legal" "beertaxa"
  .. ..$ : chr [1:2] "legal" "beertaxa"
 - attr(*, "v_scale")= int 50
 - attr(*, "est_mats")=List of 50
  ..$ : num [1:2, 1:14] -0.405 0.45 -0.405 0.393 -0.405 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.4211 0.2041 0.0375 0.1771 0.0392 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.5513 0.0676 -0.5513 0.059 -0.2739 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.136 0 0.119 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0338 0 0.0295 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0355 0 0.029 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.7689 0.067 -0.7689 0.0583 -0.5169 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.2735 0.0545 -0.2735 0.0475 -0.1122 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0613 0 0.0535 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.676 0.202 -0.676 0.168 -0.676 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.745 0.273 -0.745 0.238 -0.241 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.295 0.127 -0.3 0.111 -0.122 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.2972 0.0592 -0.2972 0.0516 -0.2972 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0451 0 0.0365 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6943 0.0705 -0.6943 0.1069 -0.1983 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.1077 0 0.0914 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0676 0 0.059 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.27 0 0.236 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.263 0.2 -0.27 0.173 0.132 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6529 -0.057 -0.6529 -0.0602 -0.6529 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.5525 0.0583 -0.5525 0.0487 -0.5525 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.498 0.169 -0.498 0.147 0.502 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.5973 0.0381 -0.5973 0.1013 -0.5973 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.363 0 0.316 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 -0.0211 0 0.0497 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6338 0.052 -0.6338 0.0415 -0.6338 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.21459 0.02523 -0.20202 0.01657 -0.00364 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0486 0 0.0421 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.5388 0.0592 -0.5388 0.0462 -0.5388 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6905 0.0279 -0.6905 0.0243 -0.6905 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0589 0 0.0503 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0.0247 0.0364 0.0247 0.0316 0.0247 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0.00556 0.45129 0.00556 0.39352 0.00556 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.135 0 0.118 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0.0314 0.0676 0.0314 0.059 0.0314 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.486 0.273 -0.486 0.238 -0.486 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.00332 0 -0.00122 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0676 0 0.059 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.7077 0.0545 -0.7077 0.0475 0.1307 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.651 0 0.567 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.3033 0.1018 -0.2855 0.0879 -0.1075 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.7996 0.0891 -0.1284 0.0772 0.2004 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6917 0.0827 -0.6917 0.1227 -0.6917 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0922 0 0.0783 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.869 0.208 -0.702 0.181 0.131 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.6679 0.1162 -0.6679 0.0953 -0.6679 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0321 0 0.0268 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0.00299 0.14994 0.00299 0.13074 0.00299 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] 0 0.0549 0 0.0479 0 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
  ..$ : num [1:2, 1:14] -0.5186 0.0169 -0.5186 0.0147 -0.5186 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "legal" "beertaxa"
  .. .. ..$ : NULL
 - attr(*, "target")=List of 50
  ..$ 1 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 2 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 4 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 5 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 6 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 8 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 9 : num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 10: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 11: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 12: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 13: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 16: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 17: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 18: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 19: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 20: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 21: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 22: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 23: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 24: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 25: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 26: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 27: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 28: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 29: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 30: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 31: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 32: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 33: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 34: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 35: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 36: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 37: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 38: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 39: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 40: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 41: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 42: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 44: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 45: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 46: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 47: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 48: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 49: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 50: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 51: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 53: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 54: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 55: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
  ..$ 56: num [1:14, 1:14] 1 0 0 0 0 0 0 0 0 0 ...
 - attr(*, "inverse_var")= logi TRUE
 - attr(*, "ignore_FE")= logi FALSE
> 
> ## clubSandwich's vcov holds the actual variable in attribute "cluster", 
> ## not a character string like plm's vcov
> 
> # Translation of attribute "cluster"
> attr(plm:::trans_clubSandwich_vcov(vcov_club_id,   attr(model.frame(plm_unweighted), "index")), "cluster")
[1] "group"
> attr(plm:::trans_clubSandwich_vcov(vcov_club_time, attr(model.frame(plm_unweighted), "index")), "cluster")
[1] "time"
> 
> # Test if df adjustment in pwaldtest works (needs plm ver >= 1.5-34)
> df2_id <- pwaldtest(plm_unweighted, vcov = vcov_plm_id,  test = "F")[["parameter"]][2]
> if (!pwaldtest(plm_unweighted, vcov = vcov_club_id, test = "F")[["parameter"]][2] == df2_id) stop("wrong df2")
> 
> df2_time <- pwaldtest(plm_unweighted, vcov = vcov_plm_time,  test = "F")[["parameter"]][2]
> if (!pwaldtest(plm_unweighted, vcov = vcov_club_time, test = "F")[["parameter"]][2] == df2_time) stop("wrong df2")
> 
> attr(vcov_club_id, "cluster") <- "asdf"
> if (!is.null(attr(plm:::trans_clubSandwich_vcov(vcov_club_id, attr(model.frame(plm_unweighted), "index")), "cluster")))
+   stop("attr 'cluster' other than known values found but not set to NULL")
> 
> # should give warning
> attr(vcov_club_id, "cluster") <- NULL
> attr(plm:::trans_clubSandwich_vcov(vcov_club_id, attr(model.frame(plm_unweighted), "index")), "cluster")
NULL
Warning message:
In plm:::trans_clubSandwich_vcov(vcov_club_id, attr(model.frame(plm_unweighted),  :
  no attribute "cluster" found in supplied vcov object
> 
> vcov_club_id   <- vcovCR(plm_unweighted, type = "CR0", cluster = "individual") # get "fresh" vcov
> 
> # clubSandwich's Wald tests
> Wald_test(plm_unweighted, constraints = c("legal","beertaxa"), vcov = "CR1", test = "chi-sq")
   Test    F d.f.  p.val
 chi-sq 15.2  Inf <0.001
> Wald_test(plm_unweighted, constraints = c("legal","beertaxa"), vcov = "CR0", test = "Naive-F")
    Test    F d.f.  p.val
 Naive-F 15.5   49 <0.001
> Wald_test(plm_unweighted, constraints = c("legal","beertaxa"), vcov = "CR0", test = "All")
    Test    F d.f.   p.val
  chi-sq 15.5  Inf < 0.001
 Naive-F 15.5 49.0 < 0.001
     HTA 14.2 10.6 0.00101
     HTB 14.1 10.2 0.00114
     HTZ 14.6 15.3 < 0.001
     EDF 15.2 17.1 < 0.001
     EDT 10.4  Inf < 0.001
> 
> 
> summary(plm_unweighted, vcov = vcov_plm_id)
Oneway (individual) effect Within Model

Note: Coefficient variance-covariance matrix supplied: vcov_plm_id

Call:
plm(formula = mrate ~ legal + beertaxa, data = MV_deaths, effect = "individual", 
    index = c("state", "year"))

Balanced Panel: n = 50, T = 14, N = 700

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-63.212861  -6.474022  -0.083565   6.287848  60.521165 

Coefficients:
         Estimate Std. Error t-value  Pr(>|t|)    
legal      4.4176     2.1047  2.0989   0.03621 *  
beertaxa  30.2497     5.9330  5.0986 4.498e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    101380
Residual Sum of Squares: 93638
R-Squared:      0.076397
Adj. R-Squared: 0.0037058
F-statistic: 15.5331 on 2 and 49 DF, p-value: 5.9607e-06
> summary(plm_unweighted, vcov = vcov_club_id)  # just a run test
Oneway (individual) effect Within Model

Note: Coefficient variance-covariance matrix supplied: vcov_club_id

Call:
plm(formula = mrate ~ legal + beertaxa, data = MV_deaths, effect = "individual", 
    index = c("state", "year"))

Balanced Panel: n = 50, T = 14, N = 700

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-63.212861  -6.474022  -0.083565   6.287848  60.521165 

Coefficients:
         Estimate Std. Error t-value  Pr(>|t|)    
legal      4.4176     2.1047  2.0989   0.03621 *  
beertaxa  30.2497     5.9330  5.0986 4.498e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    101380
Residual Sum of Squares: 93638
R-Squared:      0.076397
Adj. R-Squared: 0.0037058
F-statistic: 15.5331 on 2 and 49 DF, p-value: 5.9607e-06
> summary(plm_unweighted, vcov = vcov_plm_time)
Oneway (individual) effect Within Model

Note: Coefficient variance-covariance matrix supplied: vcov_plm_time

Call:
plm(formula = mrate ~ legal + beertaxa, data = MV_deaths, effect = "individual", 
    index = c("state", "year"))

Balanced Panel: n = 50, T = 14, N = 700

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-63.212861  -6.474022  -0.083565   6.287848  60.521165 

Coefficients:
         Estimate Std. Error t-value  Pr(>|t|)    
legal      4.4176     1.4633  3.0189  0.002637 ** 
beertaxa  30.2497     5.7079  5.2996 1.593e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    101380
Residual Sum of Squares: 93638
R-Squared:      0.076397
Adj. R-Squared: 0.0037058
F-statistic: 14.0476 on 2 and 13 DF, p-value: 0.00056362
> summary(plm_unweighted, vcov = vcov_club_time) # just a run test
Oneway (individual) effect Within Model

Note: Coefficient variance-covariance matrix supplied: vcov_club_time

Call:
plm(formula = mrate ~ legal + beertaxa, data = MV_deaths, effect = "individual", 
    index = c("state", "year"))

Balanced Panel: n = 50, T = 14, N = 700

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-63.212861  -6.474022  -0.083565   6.287848  60.521165 

Coefficients:
         Estimate Std. Error t-value  Pr(>|t|)    
legal      4.4176     1.4633  3.0189  0.002637 ** 
beertaxa  30.2497     5.7079  5.2996 1.593e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    101380
Residual Sum of Squares: 93638
R-Squared:      0.076397
Adj. R-Squared: 0.0037058
F-statistic: 14.0476 on 2 and 13 DF, p-value: 0.00056362
> 
> # run test, gave error pre rev. 637 (in case an intercept is in the model):
> pwaldtest(plm_unweighted_re, vcov = vcovCR(plm_unweighted, type = "CR2"), test = "F")

	F test (robust), vcov: vcovCR(plm_unweighted, type = "CR2")

data:  mrate ~ legal + beertaxa
F = 3.8957, df1 = 2, df2 = 49, p-value = 0.02691

> 
> clubSandwich::coef_test(plm_unweighted, vcov = "CR0")
      Coef Estimate   SE  d.f. p-val (Satt) Sig.
1    legal     4.42 2.10 20.62       0.0483    *
2 beertaxa    30.25 5.93  8.89       <0.001  ***
> clubSandwich::coef_test(plm_unweighted, vcov = "CR0", test = "naive-t")
      Coef Estimate   SE p-val (naive-t) Sig.
1    legal     4.42 2.10           0.041    *
2 beertaxa    30.25 5.93          <0.001  ***
> clubSandwich::coef_test(plm_unweighted, vcov = "CR0", test = "saddlepoint")
      Coef Estimate   SE  s.p. p-val (Saddle) Sig.
1    legal     4.42 2.10 0.369         0.0491    *
2 beertaxa    30.25 5.93 0.453         <0.001  ***
> 
> clubSandwich::coef_test(plm_unweighted, vcov = vcov_club_id, test = "naive-t")
      Coef Estimate   SE p-val (naive-t) Sig.
1    legal     4.42 2.10           0.041    *
2 beertaxa    30.25 5.93          <0.001  ***
> clubSandwich::coef_test(plm_unweighted, vcov = "CR0", test = "All")
      Coef Estimate   SE p-val (z) Sig. p-val (naive-t) Sig.  d.f. p-val (Satt)
1    legal     4.42 2.10    0.0358    *           0.041    * 20.62       0.0483
2 beertaxa    30.25 5.93    <0.001  ***          <0.001  ***  8.89       <0.001
  Sig.  s.p. p-val (Saddle) Sig.
1    * 0.369         0.0491    *
2  *** 0.453         <0.001  ***
> lmtest::coeftest(plm_unweighted, vcov. = vcov_plm_id)

t test of coefficients:

         Estimate Std. Error t value  Pr(>|t|)    
legal      4.4176     2.1047  2.0989   0.03621 *  
beertaxa  30.2497     5.9330  5.0986 4.498e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

> lmtest::coeftest(plm_unweighted, vcov. = vcov_club_id)

t test of coefficients:

         Estimate Std. Error t value  Pr(>|t|)    
legal      4.4176     2.1047  2.0989   0.03621 *  
beertaxa  30.2497     5.9330  5.0986 4.498e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

> lmtest::coeftest(plm_unweighted, vcov. = function(x) vcovCR(x, type = "CR0", cluster = "individual"))

t test of coefficients:

         Estimate Std. Error t value  Pr(>|t|)    
legal      4.4176     2.1047  2.0989   0.03621 *  
beertaxa  30.2497     5.9330  5.0986 4.498e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

> # lmtest::coeftest(plm_unweighted, vcov. = vcovCR)# does not work due to missing default values
> 
> 
> 
> ### multiwayvcov
> # library(multiwayvcov)
> # lm_mod <- lm(mrate ~ legal + beertaxa + factor(state), data = MV_deaths)
> # summary(lm_mod)
> # vcov_multiwayvcov <- cluster.vcov(lm_mod, ~ year)
> # lmtest::coeftest(lm_mod, vcov_multiwayvcov)
> # str(vcov_multiwayvcov) # no additional information to infer vcov comes from multiwayvcov or about cluster variable
> # class(vcov_multiwayvcov)
> # on plm model
> # Error in UseMethod("estfun") : 
> #   no applicable method for 'estfun' applied to an object of class "c('plm', 'panelmodel')"
> 
> ##### lfe
> ## robust
> # library(lfe)
> # data("Grunfeld", package = "plm")
> # mod_felm_firm_robust <- felm(inv ~ value + capital | firm | 0 | firm, data = Grunfeld)
> # str(mod_felm_firm_robust)
> # 
> # mod_felm_firm_robust$clustervar # in est. object: clustervar holds the actual variable, not just a character
> # summary(mod_felm_firm_robust) # gives df adjusted F test for projected model
> # lfe:::vcov.felm(mod_felm_firm_robust) 
> # attributes(lfe:::vcov.felm(mod_felm_firm_robust)) # no special attributes -> no information about clustering in vcov object
> # str(lfe:::vcov.felm(mod_felm_firm_robust))
> 
> proc.time()
   user  system elapsed 
   3.40    0.09    3.51 
